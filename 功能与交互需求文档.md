# TrendChef 农庄智能平台 - 功能与交互需求文档

## 前言：需求背景

### 项目概述
TrendChef 农庄智能平台是一款融合AI技术、健康管理和农场生态的智能美食助手应用。该项目旨在解决用户在日常饮食中的三大痛点：
1. **不知道吃什么** - 缺乏灵感和创意
2. **不知道怎么吃健康** - 缺乏个性化营养指导
3. **不知道食材哪里买** - 缺乏可信赖的新鲜食材渠道

### 核心价值
- **智能推荐**：结合全网热点趋势和用户输入，智能生成食谱
- **健康定制**：基于《中国居民膳食指南》的个性化营养建议
- **农场直供**：连接本地有机农场，新鲜食材产地直达

### 技术架构
- **前端**：原生JavaScript + HTML5 + CSS3
- **设计风格**：深色主题 + 健康绿配色方案
- **交互模式**：移动优先的单页应用(SPA)
- **数据管理**：LocalStorage本地持久化

---

## 1. 功能地图

### 1.1 系统整体架构

```
TrendChef 农庄智能平台
├── 首页 (Home)
│   ├── AI美食生成器
│   ├── 热点标签系统
│   ├── 融合热点开关
│   └── 膳食档案关联提示
│
├── 农场发现 (Discovery)
│   ├── 分类筛选系统
│   ├── 农产品展示
│   ├── 产品详情页
│   └── 搜索功能
│
├── 食谱书 (Cookbook)
│   ├── 收藏管理
│   └── 历史记录
│
└── 个人中心 (Profile)
    ├── 用户信息展示
    ├── 膳食档案管理
    └── 统计数据
```

### 1.2 功能模块层级关系

**一级功能（核心功能）**
- AI美食生成器
- 膳食档案生成系统
- 农产品发现

**二级功能（支撑功能）**
- 热点融合模式
- 食谱收藏管理
- 搜索与筛选

**三级功能（辅助功能）**
- 首次访问引导
- 快捷标签输入
- 数据统计展示

### 1.3 功能优先级划分

| 优先级 | 功能模块 | 说明 |
|--------|---------|------|
| P0 | AI美食生成器 | 核心价值，必须可用 |
| P0 | 膳食档案生成 | 差异化竞争力 |
| P0 | 农场发现页 | 商业闭环核心 |
| P1 | 食谱收藏管理 | 用户留存关键 |
| P1 | 热点融合模式 | 增强用户体验 |
| P2 | 搜索筛选 | 提升效率 |
| P3 | 数据统计 | 增加趣味性 |

---

## 2. 用户角色与权限

### 2.1 用户角色定义

本系统当前为**单角色系统**，所有用户具有相同的功能访问权限。未来可扩展为多角色系统。

**当前角色：普通用户 (General User)**
- 身份：所有访问者
- 特征：无需注册登录，本地化数据存储
- 需求：快速生成食谱、获取健康建议、发现新鲜食材

### 2.2 功能权限矩阵

| 功能模块 | 普通用户 | 说明 |
|---------|---------|------|
| 生成食谱 | ✅ | 无限制使用 |
| 查看热点标签 | ✅ | 只读 |
| 设置膳食档案 | ✅ | 本地存储 |
| 保存食谱 | ✅ | 本地存储 |
| 浏览农产品 | ✅ | 只读 |
| 搜索筛选 | ✅ | 无限制 |

### 2.3 未来角色扩展设想

**会员用户 (Premium User)**
- 更多AI生成次数
- 专属营养师咨询
- 农场产品专享折扣

**农场管理员 (Farm Admin)**
- 上传产品信息
- 管理库存
- 查看销售数据

---

## 3. 详细功能需求

### 3.1 首页 - AI美食生成器

#### 3.1.1 功能描述
AI美食生成器是系统的核心功能，通过用户输入的食材或菜品需求，结合热点趋势和健康档案，智能生成个性化食谱。

#### 3.1.2 输入输出

**输入项：**
1. **必填项**
   - 食材或菜品描述（文本输入框）
   - 最小长度：1个字符
   - 示例："鸡胸肉"、"想吃面条"

2. **可选项**
   - 热点标签选择（点击预设标签）
   - 融合热点模式开关（布尔值）
   - 膳食档案关联（自动判断）

**输出项：**
- **食谱标题**：简洁明确的菜名
- **食谱图片**：默认占位图或AI生成图
- **基本信息**：
  - 烹饪时间（如："25分钟"）
  - 份量（如："2人份"）
  - 难度等级（如："简单"）
- **食材清单**：带分量的食材列表
- **制作步骤**：分步骤的详细说明
- **营养信息**：蛋白质、脂肪、碳水含量
- **特殊标识**（条件显示）：
  - 热点融合徽章
  - AI膳食优化提示

#### 3.1.3 业务规则

**规则1：输入验证**
```javascript
IF 输入框为空
  THEN 显示错误提示"请输入食材或菜品名称"
  AND 输入框边框变红并震动
  AND 阻止生成操作
```

**规则2：膳食档案关联**
```javascript
IF 用户已设置膳食档案
  THEN 
    - 生成时自动考虑健康需求
    - 食谱中显示"AI优化"标识
    - 调整食材配比符合健康指标
ELSE
  - 按标准模式生成
  - 显示"完善膳食档案"引导
```

**规则3：热点融合模式**
```javascript
IF 融合热点开关 = 开启
  THEN
    - 加载提示文案显示热点融合相关步骤
    - 标题添加热点前缀（如"🔥 网红空气炸锅版·"）
    - 烹饪步骤融入流行做法
    - 显示社交数据（播放量、点赞数）
    - 营养数据优化（降低热量和脂肪）
ELSE
    - 标准生成流程
```

**规则4：标签智能联想**
```javascript
IF 用户点击热点标签
  THEN 标签文本自动填入输入框
  AND 如果输入框已有内容，则追加（用逗号分隔）

IF 标签 IN ["减脂塑形", "三高调理", "老年康养"]
  THEN 自动触发膳食档案关联提示
```

#### 3.1.4 异常情况处理

| 异常场景 | 处理策略 |
|---------|---------|
| 网络请求超时 | 显示"生成失败，请重试"，保留用户输入 |
| 输入包含敏感词 | 提示"输入内容不合规，请修改" |
| 服务器错误500 | 显示友好错误页，提供重试按钮 |
| 输入过长(>200字符) | 自动截断并提示 |
| 连续快速点击生成 | 防抖处理，忽略重复请求 |

#### 3.1.5 界面元素清单

```
Hero区域
├── 主标题："您的康养膳食顾问"
├── 副标题："让每一餐都成为修护身心的良方。"
└── 膳食档案提示条（条件显示）

生成器卡片
├── 热点标签轮播
│   ├── 标签1: "空气炸锅"
│   ├── 标签2: "尹正焖菜"
│   ├── 标签3: "减脂塑形"
│   └── 标签4: "三高调理"
├── 输入框（多行文本域）
├── 控制区
│   ├── 膳食档案引导模块（条件显示）
│   └── 操作按钮组
│       ├── 融合热点开关按钮
│       └── 生成菜谱按钮（主按钮）
└── 加载状态动画

结果展示卡片（生成后显示）
├── 食谱图片
├── 热点融合徽章（条件显示）
├── 食谱标题
├── 食谱描述
├── 元数据（时间/份量/难度）
├── 制作步骤列表
├── AI优化建议（条件显示）
└── 操作按钮
    ├── 保存到食谱书
    └── 分享
```

### 3.2 膳食档案生成系统

#### 3.2.1 功能描述
基于《中国居民膳食指南（2022版）》，通过AI分析用户的健康信息，生成个性化的营养建议报告，为后续食谱生成提供健康指导基础。

#### 3.2.2 输入输出

**输入项：**
1. **快捷标签选择（多选）**
   - 对象类型：上班族、老年人、儿童、健身党
   - 健康目标：减脂、增肌、控糖、养胃
   - 健康状况：高血压、海鲜过敏、乳糖不耐、不吃辣

2. **补充描述（可选）**
   - 自由文本输入
   - 用于提供更详细的个人信息
   - 如：身高、体重、具体症状等

**输出项：**
- **个性化膳食报告**（Markdown格式）
  - 用户画像评估
  - 核心膳食建议
  - 宏量营养素配比
  - 微量营养素补充
  - 每日必吃清单
  - 特别叮嘱
  - 一周食材采购建议
  
- **结构化数据摘要**
  - 年龄/性别
  - BMI指数和状态
  - 健康目标标签
  - 慢性病标签
  - 每日能量建议
  - 营养素配比

#### 3.2.3 业务规则

**规则1：输入验证**
```javascript
IF 快捷标签选中数量 = 0 AND 补充描述长度 < 5
  THEN 显示提示"请至少选择一个标签或输入简单的描述"
  AND 阻止生成

IF 快捷标签选中数量 >= 1 OR 补充描述长度 >= 5
  THEN 允许生成
```

**规则2：AI生成逻辑**
```javascript
合并输入 = 标签文本.join("，") + "。补充信息：" + 补充描述

调用AI API({
  prompt: 基础prompt + 合并输入 + 膳食指南知识库,
  temperature: 0.7,
  max_tokens: 2000
})

解析AI返回 -> {
  report: Markdown格式报告,
  parsedProfile: 结构化用户档案,
  dietPlan: 结构化膳食方案
}
```

**规则3：报告保存**
```javascript
IF 用户点击"保存档案"
  THEN
    - 将报告和结构化数据存储到 localStorage
    - 更新全局状态 isSet = true
    - 关闭弹窗
    - 首页显示"已关联膳食档案"提示
    - Toast提示"膳食档案已保存"
```

**规则4：报告编辑**
```javascript
用户可以：
  - 重新填写（清空当前数据，返回输入界面）
  - 编辑内容（直接修改生成的报告文本）
  - 调整数据（编辑结构化的营养数据）
```

#### 3.2.4 异常情况处理

| 异常场景 | 处理策略 |
|---------|---------|
| AI生成失败 | 显示"生成失败，请重试"，保留输入内容 |
| 生成内容为空 | 使用默认模板，标注为"通用健康档案" |
| 解析失败 | 显示原始文本，结构化数据使用默认值 |
| 保存失败 | 提示"保存失败，请检查存储空间" |
| 数据丢失 | 首次访问引导重新生成 |

#### 3.2.5 界面元素清单

```
膳食档案弹窗
├── 头部
│   ├── 图标 🥗
│   ├── 标题："AI 膳食健康顾问"
│   ├── 副标题："为您定制专属的营养引擎"
│   └── 关闭按钮
│
├── 输入步骤（Step 1）
│   ├── 引导标签："如果您是为自己或家人定制，请描述："
│   ├── 快捷标签区
│   │   ├── 对象标签组
│   │   │   ├── 💼 上班族
│   │   │   ├── 👴 老年人
│   │   │   ├── 🧒 儿童
│   │   │   └── 🏋️ 健身党
│   │   ├── 目标标签组
│   │   │   ├── 🔥 减脂
│   │   │   ├── 💪 增肌
│   │   │   ├── 🍬 控糖
│   │   │   └── 🥬 养胃
│   │   └── 状况标签组
│   │       ├── 🩺 高血压
│   │       ├── 🦐 海鲜过敏
│   │       ├── 🥛 乳糖不耐
│   │       └── 🌶️ 不吃辣
│   ├── 补充描述输入框（多行文本）
│   └── 生成按钮
│
├── 加载步骤（Loading）
│   ├── 加载动画（旋转圆环 + 脉冲效果）
│   └── 步骤文案轮播
│       ├── "🔍 正在分析您的身体数据..."
│       ├── "📚 正在研读《中国居民膳食指南》..."
│       └── "✨ 正在为您定制专属食谱方案..."
│
└── 报告步骤（Step 2）
    ├── 报告头部摘要
    │   ├── 年龄/性别标签
    │   ├── BMI标签
    │   ├── 目标标签
    │   └── 健康状况标签
    ├── 报告内容展示区（Markdown渲染）
    ├── 报告编辑器（隐藏，编辑模式显示）
    └── 操作按钮组
        ├── 重新填写
        ├── 编辑内容
        └── 保存档案
```

### 3.3 农场发现页

#### 3.3.1 功能描述
展示本地农场的应季农产品信息，用户可以浏览、搜索、查看详情，为未来的购买功能预留接口。

#### 3.3.2 输入输出

**输入项：**
1. **分类筛选**
   - 当季蔬菜
   - 有机特供
   - 农场活动

2. **搜索关键词**
   - 产品名称搜索
   - 实时过滤

**输出项：**
- **产品列表**（卡片网格布局）
  - 产品图片
  - 产品名称
  - 状态标签（今日上新、热卖中等）
  - 来源标签（农场直供、有机认证）
  - 价格信息
  - 简短描述

- **产品详情页**
  - 高清产品图
  - 完整标题
  - 价格和单位
  - 标签（平台认证、特色标签）
  - 卖家信息卡片
  - 详细介绍
  - 产地/地址信息
  - 底部操作栏

#### 3.3.3 业务规则

**规则1：分类切换**
```javascript
IF 用户点击分类Tab
  THEN
    - 更新激活状态（视觉高亮）
    - 加载对应分类的产品数据
    - 滚动到页面顶部
    - 清空搜索框（可选）
```

**规则2：搜索过滤**
```javascript
IF 搜索框输入变化
  THEN 实时过滤产品列表
  
过滤逻辑：
  匹配字段 = [产品标题, 产品描述]
  匹配方式 = 包含关系（忽略大小写）
  
IF 过滤结果为空
  THEN 显示"没有找到匹配的农产品"
```

**规则3：详情页跳转**
```javascript
IF 用户点击产品卡片
  THEN
    - 隐藏列表页
    - 显示详情页
    - 填充产品详细信息
    - Header标题改为"详情"
    - 隐藏分类Tab
```

**规则4：返回交互**
```javascript
IF 用户点击返回按钮
  THEN
    - 隐藏详情页
    - 显示列表页
    - Header标题恢复为"发现"
    - 显示分类Tab
    - 恢复之前的筛选状态
```

#### 3.3.4 Mock数据结构

```javascript
产品对象 = {
  title: "产品名称",
  heat: "状态标签",  // 如："今日上新"
  platform: "来源标签",  // 如："农场直供"
  badge: "特色标签",  // 如："有机认证"
  statusIcon: "状态图标",  // 如："🌱"
  price: "价格",  // 如："9.9/斤"
  desc: "描述文本",
  highlight: "亮点说明",
  image: "图片URL"
}
```

#### 3.3.5 界面元素清单

```
发现页主界面
├── Header
│   ├── 标题："发现"
│   ├── 分类Tab栏
│   │   ├── 当季蔬菜（默认选中）
│   │   ├── 有机特供
│   │   └── 农场活动
│   └── 搜索框
│
└── 产品网格
    └── 产品卡片 ×N
        ├── 产品图片
        ├── 产品标题
        ├── 产品描述
        └── 元信息（价格+来源）

产品详情页
├── 浮动返回按钮（左上角）
├── 产品大图
├── 内容区
│   ├── 详情头部
│   │   ├── 标题
│   │   ├── 价格行（价格+单位）
│   │   └── 标签列表
│   ├── 卖家信息卡片
│   │   ├── 头像
│   │   ├── 卖家名称
│   │   ├── 认证徽章
│   │   └── 联系按钮
│   ├── 详细介绍区块
│   └── 产地/地址区块
└── 底部操作栏（固定定位）
    ├── 导航去农场按钮
    └── 联系卖家按钮
```

### 3.4 食谱书

#### 3.4.1 功能描述
管理用户保存的食谱，提供查看详情和删除功能。

#### 3.4.2 输入输出

**输入项：**
- 用户操作：查看详情 / 删除

**输出项：**
- 食谱卡片列表
- 空状态提示

#### 3.4.3 业务规则

```javascript
IF 保存的食谱数量 = 0
  THEN 显示空状态
  ELSE 显示食谱网格

IF 用户点击"查看详情"
  THEN
    - 切换到首页Tab
    - 渲染该食谱的完整内容

IF 用户点击"删除"
  THEN
    - 从列表中移除
    - 更新 localStorage
    - 重新渲染列表
```

### 3.5 个人中心

#### 3.5.1 功能描述
展示用户统计信息和膳食档案，提供档案管理功能。

#### 3.5.2 界面元素清单

```
个人中心页
├── 用户信息卡片
│   ├── 头像
│   ├── 昵称："美食探索者"
│   ├── 身份："TrendChef 会员"
│   └── 统计数据
│       ├── 生成次数：12
│       ├── 收藏次数：8
│       └── 分享次数：5
│
└── 膳食档案卡片
    ├── 状态：未设置
    │   ├── 空状态提示
    │   └── 引导按钮："立即建立档案"
    │
    └── 状态：已设置
        ├── 卡片标题："📋 我的膳食档案"
        ├── 生成日期
        ├── 结构化数据预览
        │   ├── 膳食建议
        │   │   ├── 每日热量
        │   │   ├── 碳水比例
        │   │   ├── 蛋白质比例
        │   │   └── 脂肪比例
        │   ├── 身体档案
        │   │   ├── 年龄
        │   │   ├── 身高
        │   │   ├── 体重
        │   │   └── BMI（含状态标签）
        │   └── 标签列表
        │       ├── 健康状况标签
        │       ├── 健康目标标签
        │       └── 饮食禁忌标签
        └── 操作按钮
            ├── 调整数据（编辑模式）
            ├── 完整档案（查看完整报告）
            └── 重置演示（开发调试用）
```

---

## 4. 用户交互流程

### 4.1 首次访问流程

```
用户打开应用
    ↓
判断：是否首次访问？
    ├─ 是 → 显示欢迎弹窗
    │       ├─ 文案："欢迎来到 TrendChef 农庄智能平台"
    │       ├─ 说明："我是您的专属AI营养师..."
    │       └─ 操作选择
    │           ├─ [生成膳食档案] → 打开膳食档案弹窗
    │           └─ [先看看] → 关闭弹窗，显示引导提示
    │
    └─ 否 → 直接进入首页
            ↓
            判断：是否已设置膳食档案？
                ├─ 是 → 显示"已关联膳食档案"提示
                └─ 否 → 显示"完善膳食档案"引导模块
```

### 4.2 生成食谱流程

```
用户在首页
    ↓
输入食材/菜品（必填）
    ↓
（可选）点击热点标签 → 标签内容自动填入输入框
    ↓
（可选）开启"融合热点"开关 → 开关变为激活状态（橙色）
    ↓
点击"生成菜谱"按钮
    ↓
验证输入
    ├─ 失败 → 显示错误提示 + 输入框抖动
    └─ 成功 → 显示加载动画
                ↓
                判断：是否开启融合热点？
                ├─ 是 → 显示热点相关加载文案
                │       "🔥 正在融合当前美食热点..."
                │       "📱 正在检索TikTok/小红书热门做法..."
                └─ 否 → 显示标准加载文案
                        "AI 正在分析您的需求..."
                        "正在检索150万+菜谱数据库..."
                ↓
                判断：是否已设置膳食档案？
                ├─ 是 → AI生成时考虑健康需求
                └─ 否 → 标准生成
                ↓
                生成完成（2.5秒后）
                ↓
                隐藏加载动画，显示结果卡片
                ↓
                滚动到结果位置
                ↓
                判断：是否热点模式？
                ├─ 是 → 显示热点融合徽章
                │       显示Toast："🔥 热点融合完成！"
                └─ 否 → 标准展示
                ↓
                判断：是否关联档案？
                ├─ 是 → 显示AI优化建议区块
                │       显示Toast："✨ 已根据您的膳食档案优化推荐"
                └─ 否 → 不显示
```

### 4.3 设置膳食档案流程

```
用户触发档案设置
├─ 入口1：首页"完善膳食档案"引导
├─ 入口2：Header"膳食档案"按钮
└─ 入口3：首次访问欢迎弹窗
    ↓
打开膳食档案弹窗
    ↓
判断：是否已有档案？
    ├─ 是 → 显示报告展示步骤（Step 2）
    │       ├─ 显示结构化摘要
    │       ├─ 显示完整报告（Markdown渲染）
    │       └─ 操作选择
    │           ├─ [重新填写] → 返回输入步骤
    │           ├─ [编辑内容] → 切换编辑模式
    │           └─ [保存档案] → 更新存储 + 关闭弹窗
    │
    └─ 否 → 显示输入步骤（Step 1）
            ↓
            用户选择快捷标签（多选）
            ├─ 点击标签 → 标签高亮显示（active状态）
            └─ 再次点击 → 取消选中
            ↓
            （可选）输入补充描述
            ↓
            点击"生成膳食建议"按钮
            ↓
            验证输入
            ├─ 失败 → 显示提示："请至少选择一个标签或输入简单的描述"
            └─ 成功 → 切换到加载状态
                        ↓
                        显示加载动画（旋转圆环 + 脉冲）
                        ↓
                        步骤文案轮播（每1秒切换）
                        ├─ "🔍 正在分析您的身体数据..."
                        ├─ "📚 正在研读《中国居民膳食指南》..."
                        └─ "✨ 正在为您定制专属食谱方案..."
                        ↓
                        调用AI API（模拟：3秒后返回）
                        ↓
                        生成报告（Markdown格式）
                        ↓
                        解析结构化数据
                        ↓
                        切换到报告展示步骤（Step 2）
                        ↓
                        显示结构化摘要（顶部）
                        ↓
                        渲染Markdown报告
                        ↓
                        用户操作选择
                        ├─ [重新填写] → 返回 Step 1
                        ├─ [编辑内容] → 切换编辑/预览模式
                        └─ [保存档案] → 执行保存
                                        ↓
                                        存储到 localStorage
                                        ↓
                                        更新全局状态 isSet = true
                                        ↓
                                        按钮文字变为"已保存"
                                        ↓
                                        0.5秒后关闭弹窗
                                        ↓
                                        显示Toast："膳食档案已保存"
                                        ↓
                                        首页更新UI
                                        ├─ 隐藏引导模块
                                        └─ 显示"已关联膳食档案"提示
```

### 4.4 浏览农产品流程

```
用户点击"发现"Tab
    ↓
加载农场发现页
    ↓
显示分类Tab（默认：当季蔬菜）
    ↓
显示产品网格
    ↓
用户操作分支
    ├─ 分支1：切换分类
    │   ↓
    │   点击分类Tab（如：有机特供）
    │   ↓
    │   Tab切换激活状态
    │   ↓
    │   加载对应分类产品
    │   ↓
    │   滚动到顶部
    │
    ├─ 分支2：搜索产品
    │   ↓
    │   在搜索框输入关键词
    │   ↓
    │   实时过滤产品列表
    │   ├─ 有结果 → 显示匹配的产品
    │   └─ 无结果 → 显示"没有找到匹配的农产品"
    │
    └─ 分支3：查看详情
        ↓
        点击产品卡片
        ↓
        列表页隐藏（display: none）
        ↓
        详情页显示（display: block）
        ↓
        Header更新
        ├─ 标题改为"详情"
        └─ 隐藏分类Tab
        ↓
        填充产品详细信息
        ├─ 大图展示
        ├─ 标题、价格、标签
        ├─ 卖家信息
        ├─ 详细介绍
        └─ 产地地址
        ↓
        底部操作栏显示
        ├─ 导航去农场（点击 → alert提示）
        └─ 联系卖家（点击 → alert提示）
        ↓
        用户点击返回按钮
        ↓
        详情页隐藏
        ↓
        列表页恢复显示
        ↓
        Header恢复
        ├─ 标题改为"发现"
        └─ 显示分类Tab
```

### 4.5 保存与查看食谱流程

```
用户生成食谱后
    ↓
点击"保存到食谱书"按钮
    ↓
验证：lastRecipe是否存在？
    ├─ 否 → 显示Toast："暂无可保存的食谱，请先生成"
    └─ 是 → 执行保存
            ↓
            添加到 savedRecipes 数组（头部插入）
            ↓
            存储到 localStorage
            ↓
            重新渲染食谱书页面
            ↓
            显示Toast："已保存到食谱书！"

---

用户切换到"食谱"Tab
    ↓
判断：savedRecipes数量？
    ├─ = 0 → 显示空状态
    │        ├─ 图标 📖
    │        ├─ 文案："还没有保存的食谱"
    │        └─ 引导按钮 → 点击跳转到首页
    │
    └─ > 0 → 显示食谱网格
             ├─ 每个食谱卡片包含
             │   ├─ 缩略图
             │   ├─ 标题
             │   ├─ 保存时间
             │   ├─ 简短描述
             │   └─ 操作按钮
             │       ├─ [查看详情] → 跳转到首页并渲染该食谱
             │       └─ [删除] → 从列表移除
             └─ 响应式网格布局（移动端2列，桌面端自适应）
```

### 4.6 编辑膳食档案流程

```
用户在个人中心
    ↓
查看膳食档案卡片
    ↓
点击"调整数据"按钮
    ↓
进入编辑模式
    ↓
所有数值字段变为可编辑输入框
    ├─ 每日热量输入框
    ├─ 碳水比例输入框
    ├─ 蛋白质比例输入框
    ├─ 脂肪比例输入框
    ├─ 年龄输入框
    ├─ 身高输入框
    ├─ 体重输入框
    ├─ 健康状况输入框（逗号分隔）
    ├─ 健康目标输入框（逗号分隔）
    └─ 饮食禁忌输入框（逗号分隔）
    ↓
    用户修改数值
    ↓
    输入框失焦时自动保存到内存
    ├─ 更新 state.dietaryGuideline.parsedProfile
    └─ 更新 state.dietaryGuideline.dietPlan
    ↓
    判断：修改了身高或体重？
    ├─ 是 → 自动重新计算BMI和BMI状态
    └─ 否 → 仅保存修改值
    ↓
    用户点击"💾 保存修改"按钮
    ↓
    退出编辑模式
    ↓
    输入框恢复为静态文本显示
    ↓
    持久化到 localStorage
    ↓
    显示Toast："档案已保存"
    ↓
    重新渲染卡片（显示更新后的数据）
```

---

## 5. 界面要求

### 5.1 整体布局结构

#### 5.1.1 应用容器结构

```
.app-container (全屏容器)
├── .app-header (顶部导航栏，sticky定位)
├── .main-content (内容主区域，可滚动)
│   └── .content-section (各个页面section)
└── .bottom-nav (底部导航栏，fixed定位)
```

#### 5.1.2 响应式断点

| 断点名称 | 屏幕宽度 | 布局调整 |
|---------|---------|---------|
| Mobile | < 768px | 单列布局，字体缩小 |
| Tablet | 768px - 1024px | 2列网格 |
| Desktop | > 1024px | 3列网格，内容居中最大宽1200px |

### 5.2 主要页面布局

#### 5.2.1 首页布局

```
[Header: TrendChef + 健康档案按钮]

[Hero区域]
├─ 主标题（居中）
├─ 副标题（居中）
└─ 膳食档案提示条（条件显示）

[生成器卡片]
├─ 热点标签轮播（水平滚动）
├─ 输入框（多行，自动高度）
├─ 膳食档案引导（条件显示）
└─ 操作区
    ├─ 融合热点开关（左，1/3宽度）
    └─ 生成按钮（右，2/3宽度）

[加载状态]
└─ 居中动画 + 文案

[结果卡片]
├─ 图片（16:9宽高比）
├─ 热点徽章（顶部，条件显示）
├─ 标题
├─ 描述
├─ 元信息行
├─ 步骤列表
├─ AI优化建议（条件显示）
└─ 操作按钮（2按钮，等宽）

[Bottom Nav: 4个Tab]
```

#### 5.2.2 发现页布局

```
[Header: 发现 + 分类Tab + 搜索框]

[产品网格]
└─ 响应式网格
    ├─ Mobile: minmax(150px, 1fr)
    ├─ Tablet: minmax(200px, 1fr)
    └─ Desktop: minmax(280px, 1fr)

[Bottom Nav]
```

#### 5.2.3 详情页布局（全屏覆盖）

```
[浮动返回按钮]（左上角）

[产品大图]（高度300px）

[内容区]（圆角卡片，向上覆盖图片底部20px）
├─ 详情头部
├─ 卖家信息卡片
├─ 介绍区块
├─ 产地区块
└─ 底部留白（80px，防遮挡）

[底部操作栏]（fixed，底部）
└─ 2按钮，等宽
```

### 5.3 关键UI组件

#### 5.3.1 按钮规范

| 按钮类型 | 样式 | 使用场景 |
|---------|------|---------|
| Primary | 纯白背景 + 黑色文字 | 主要操作（生成、保存） |
| Secondary | 透明背景 + 边框 | 次要操作（分享、返回） |
| Accent | 健康绿渐变 + 白色文字 | 强调操作（保存档案） |
| Outline | 透明背景 + 半透明边框 | 辅助操作（编辑、重新填写） |

**悬停效果：**
- Primary: opacity: 0.9
- Secondary: border-color变亮
- Accent: 上移2px + 阴影增强
- Outline: background亮度提升

#### 5.3.2 输入框规范

| 输入类型 | 样式特征 | 交互反馈 |
|---------|---------|---------|
| 单行文本 | 圆角12px，padding 1.2rem | 聚焦时边框变绿色 + 外发光 |
| 多行文本 | 圆角12px，min-height 250px | 聚焦时边框变绿色 + 外发光 |
| 搜索框 | 圆角全圆，左侧图标 | 聚焦时边框变绿色 |

**占位符样式：**
- 颜色：#707070（暗灰色）
- 字号：比正文小5%

#### 5.3.3 卡片规范

**标准卡片：**
```css
background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
border: 1px solid #2a2a2a;
border-radius: 16px;
padding: 1.5rem 2rem;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
```

**悬停效果：**
```css
transform: translateY(-4px);
transition: transform 0.3s ease;
```

#### 5.3.4 标签规范

| 标签类型 | 样式 | 使用场景 |
|---------|------|---------|
| 热点标签 | 透明 + 红色边框 | 热门趋势 |
| 健康标签 | 透明 + 绿色边框 | 健康场景 |
| 状态标签 | 半透明背景 | 产品状态 |
| 认证标签 | 绿色背景 | 平台认证 |

**交互状态：**
- 默认：半透明
- 悬停：背景亮度提升 + 上移1px
- 激活：填充背景色 + 边框加粗

### 5.4 响应式设计要求

#### 5.4.1 移动端优化（< 768px）

1. **布局调整**
   - 所有网格改为单列或双列
   - 卡片padding减小（1rem）
   - 字号缩小10%

2. **交互优化**
   - 增大可点击区域（最小44×44px）
   - 横向滚动内容显示滚动指示器
   - 表单字段聚焦时禁用页面缩放

3. **导航优化**
   - 底部导航高度70px
   - Tab图标26×26px
   - 文字大小0.75rem

#### 5.4.2 触摸交互

**所有可交互元素：**
- 添加 `:active` 伪类样式（按下时缩小至0.95倍）
- 触摸反馈时间150ms
- 禁用iOS默认的高亮效果

```css
button:active {
    transform: scale(0.95);
    transition: transform 0.15s ease;
}
```

### 5.5 状态反馈机制

#### 5.5.1 加载状态

**类型1：全局加载**
- 位置：覆盖内容区
- 动画：翻书动画（3个书页轮流翻转）
- 文案：动态更新的提示文字
- 时长：2.5秒

**类型2：局部加载**
- 位置：弹窗内部
- 动画：旋转圆环 + 脉冲扩散
- 文案：分步骤轮播（每1秒切换）
- 时长：3秒

**类型3：按钮加载**
- 位置：按钮内部
- 动画：小型旋转圆环
- 文案：按钮文字变为"处理中..."
- 交互：按钮禁用，阻止重复点击

#### 5.5.2 成功状态

**Toast提示：**
- 位置：屏幕右上角（移动端：顶部居中）
- 样式：绿色左边框 + 白色背景
- 图标：✅
- 动画：
  - 入场：从右侧滑入（X轴平移）
  - 停留：3秒
  - 出场：淡出消失
  
**按钮状态：**
- 文字变更："保存档案" → "已保存"
- 颜色变灰
- 禁用点击

#### 5.5.3 错误状态

**Toast提示：**
- 位置：屏幕右上角
- 样式：红色左边框 + 白色背景
- 图标：❌
- 动画：抖动效果

**输入框验证：**
- 边框颜色：#ff6b6b（红色）
- 抖动动画：水平震动（-10px ↔ +10px）
- 聚焦时保持错误状态
- 输入后自动清除错误

#### 5.5.4 警告状态

**Toast提示：**
- 图标：⚠️
- 样式：橙色左边框
- 使用场景：输入不完整、操作需确认等

#### 5.5.5 空状态

**展示元素：**
- 大号图标（4rem，半透明）
- 标题（1.5rem）
- 描述文字（灰色，0.875rem）
- 引导按钮（可选）

**示例：食谱书空状态**
```
    📖（4rem，opacity: 0.5）
    
    还没有保存的食谱
    
    快去生成或收藏你喜欢的食谱吧!
    
    [开始生成]（绿色渐变按钮）
```

---

## 6. 交互规范

### 6.1 导航模式

#### 6.1.1 底部Tab导航

**行为规范：**
1. 点击Tab时立即切换（无动画延迟）
2. 当前Tab视觉高亮（图标变绿 + 上移2px）
3. 切换时内容区淡入动画（opacity 0→1，0.3s）
4. 自动滚动到页面顶部

**状态管理：**
```javascript
currentTab: 'home' | 'discover' | 'cookbook' | 'profile'
```

**Header动态更新：**
| Tab | Header标题 | 右侧元素 |
|-----|-----------|---------|
| home | "AI农庄美食专家" | - |
| discover | "发现" | 分类Tab + 搜索框 |
| cookbook | "食谱" | - |
| profile | (无标题) | - |

#### 6.1.2 弹窗导航

**打开方式：**
1. 按钮点击
2. 引导提示点击
3. 首次访问自动触发（欢迎弹窗）

**关闭方式：**
1. 点击关闭按钮（×）
2. 点击蒙层（overlay）
3. 操作完成自动关闭（保存后）

**动画规范：**
- 入场：从下方滑入 + 淡入（0.3s cubic-bezier）
- 出场：淡出（0.3s）
- 蒙层：渐变黑色（rgba(0,0,0,0.8)）+ 毛玻璃效果

### 6.2 表单交互规则

#### 6.2.1 输入框交互

**聚焦行为：**
```css
focus:
  border-color: #52c41a (健康绿)
  box-shadow: 0 0 0 4px rgba(82, 196, 26, 0.1) (外发光)
  background: 亮度提升5%
```

**输入限制：**
| 字段 | 最小长度 | 最大长度 | 允许字符 |
|-----|---------|---------|---------|
| 食材输入 | 1字符 | 200字符 | 中英文、数字、逗号 |
| 膳食档案描述 | 5字符 | 1000字符 | 中英文、数字、标点 |
| 搜索框 | 无限制 | 50字符 | 中英文、数字 |

**实时验证：**
- 输入超长时自动截断
- 提交前验证必填项
- 错误时显示红色边框 + 提示文字

#### 6.2.2 标签选择交互

**单次点击行为：**
```javascript
IF 标签未选中
  THEN 
    - 添加 .active 类
    - 背景色填充
    - 边框加粗
    - 触觉反馈（transform: scale(0.95)）
ELSE
  - 移除 .active 类
  - 恢复默认样式
```

**视觉反馈：**
- 默认：半透明背景 + 半透明边框
- 悬停：背景亮度提升 + 上移1px
- 激活：填充背景 + 边框变色
- 动画：0.2s ease过渡

#### 6.2.3 开关交互

**融合热点开关：**

**默认状态（关闭）：**
```css
background: rgba(255, 255, 255, 0.1);
color: #b0b0b0;
border: 1px solid rgba(255, 255, 255, 0.1);
icon: 灰度滤镜 + 半透明
```

**激活状态（开启）：**
```css
background: #ff5722 (纯橙色);
color: #fff;
border: none;
box-shadow: 0 4px 12px rgba(255, 87, 34, 0.3);
icon: 无滤镜 + 缩放1.1 + 火焰闪烁动画
```

**点击行为：**
1. 立即切换状态（无延迟）
2. 播放缩放动画（scale: 1 → 0.96 → 1）
3. 更新全局状态 `isTrendFusionActive`
4. （可选）震动反馈（移动端）

### 6.3 数据展示方式

#### 6.3.1 列表/网格展示

**产品网格：**
- 布局：CSS Grid（响应式列数）
- 间距：1rem（移动端）/ 1.5rem（桌面端）
- 加载：一次性加载（无分页）
- 排序：固定顺序（由数据源决定）

**食谱网格：**
- 布局：2列（移动端）/ 自适应（桌面端）
- 卡片高度：自适应内容
- 空状态：居中展示引导

#### 6.3.2 详情页展示

**布局模式：**
1. 大图展示（占满屏幕宽度）
2. 内容区向上覆盖图片底部（圆角处理）
3. 信息分区块展示（卡片式）
4. 底部操作栏固定（安全区域适配）

**滚动行为：**
- 滚动平滑（smooth scroll）
- 返回按钮始终可见（fixed定位）
- 底部操作栏在滚动时不隐藏

#### 6.3.3 数据卡片展示

**膳食档案卡片结构：**
```
[分组标题]
  [数据项1] Label → Value（可编辑输入框或静态文本）
  [数据项2] Label → Value
  ...
[分组标题]
  [数据项N] Label → Value
```

**可视化元素：**
- BMI状态：彩色标签（蓝/绿/黄/红）
- 营养比例：文字描述（如"50-55%"）
- 标签列表：彩色标签平铺（flexbox wrap）

### 6.4 动效和过渡要求

#### 6.4.1 页面切换动效

```css
/* 淡入 */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
duration: 0.3s
easing: ease
```

#### 6.4.2 弹窗动效

```css
/* 弹窗入场 */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
duration: 0.3s
easing: cubic-bezier(0.4, 0, 0.2, 1)

/* 蒙层淡入 */
overlay: opacity 0 → 1 (0.3s)
```

#### 6.4.3 按钮动效

**悬停（Hover）：**
```css
Primary: opacity: 0.9
Accent: transform: translateY(-2px) + box-shadow增强
Secondary: border-color变亮
```

**点击（Active）：**
```css
transform: scale(0.96)
transition: 0.15s ease
```

#### 6.4.4 加载动效

**类型1：翻书动画**
```css
3个书页元素
依次旋转（rotateY: 0deg → -180deg）
持续时间：1.5s
循环：infinite
延迟：0s / 0.5s / 1s
```

**类型2：旋转圆环**
```css
border-spinner: rotate(0deg → 360deg)
持续时间：1s
循环：infinite
缓动：linear

外圈脉冲：scale(1 → 1.5) + opacity(1 → 0)
持续时间：2s
循环：infinite
```

#### 6.4.5 微交互动效

**Toast通知：**
```css
入场：translateX(400px) → translateX(0)
停留：3秒
出场：opacity: 1 → 0
```

**标签点击反馈：**
```css
transform: scale(0.95)
持续时间：0.15s
```

**输入框错误抖动：**
```css
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}
持续时间：0.5s
```

**火焰闪烁（融合热点图标）：**
```css
@keyframes flame-flicker {
  0% { transform: scale(1.1) rotate(-3deg); }
  25% { transform: scale(1.2) rotate(3deg); }
  50% { transform: scale(1.05) rotate(-2deg); }
  75% { transform: scale(1.15) rotate(2deg); }
  100% { transform: scale(1.1) rotate(-3deg); }
}
持续时间：1.5s
循环：infinite
缓动：alternate
```

---

## 7. 技术实现要点

### 7.1 前端架构

#### 7.1.1 技术栈
- **HTML5**：语义化标签
- **CSS3**：自定义属性（CSS Variables） + Flexbox + Grid
- **JavaScript (ES6+)**：原生JS，无框架依赖

#### 7.1.2 状态管理

```javascript
const state = {
    currentTab: 'home',  // 当前激活的Tab
    credits: 3,  // 剩余次数（预留）
    discoveryCategory: 'all',  // 发现页分类
    discoverySearch: '',  // 搜索关键词
    generatedRecipes: [],  // 生成历史
    savedRecipes: [],  // 收藏列表
    lastRecipe: null,  // 最后生成的食谱
    isTrendFusionActive: false,  // 融合热点开关
    
    // 膳食档案
    dietaryGuideline: {
        userInput: '',  // 用户输入的补充描述
        selectedTags: [],  // 选中的快捷标签
        report: '',  // AI生成的报告（Markdown）
        generatedAt: null,  // 生成时间
        isSet: false,  // 是否已设置
        parsedProfile: null,  // 结构化用户档案
        dietPlan: null,  // 结构化膳食方案
        isEditingStructured: false  // 是否处于编辑模式
    }
};
```

#### 7.1.3 本地存储策略

```javascript
// Storage Keys
const STORAGE_KEYS = {
    DIETARY_GUIDELINE: 'trendchef_dietary_guideline',
    SAVED_RECIPES: 'trendchef_saved_recipes',
    HAS_SEEN_WELCOME: 'trendchef_has_seen_welcome'
};

// 存储操作
localStorage.setItem(key, JSON.stringify(value));
const value = JSON.parse(localStorage.getItem(key));
```

### 7.2 关键算法逻辑

#### 7.2.1 食谱生成逻辑

```javascript
function generateMockRecipe(input, useTrend = false) {
    // 1. 根据输入关键词匹配食谱模板
    const recipeTemplate = matchRecipeTemplate(input);
    
    // 2. 如果开启热点模式，进行差异化改造
    if (useTrend) {
        // 标题添加热点前缀
        recipeTemplate.title = addTrendPrefix(recipeTemplate.title);
        
        // 标签添加热点元素
        recipeTemplate.tags.push('🔥 网红吃法', '✨ 热点融合');
        
        // 营养数据优化（降低热量和脂肪）
        recipeTemplate.calories = Math.round(recipeTemplate.calories * 0.88);
        recipeTemplate.nutrition.fat = (parseFloat(recipeTemplate.nutrition.fat) * 0.6).toFixed(1) + 'g';
        
        // 烹饪时间缩短
        recipeTemplate.time = Math.max(parseInt(recipeTemplate.time) - 5, 15) + '分钟';
        
        // 描述添加社交数据
        recipeTemplate.description = addSocialData(recipeTemplate.description);
        
        // 步骤修改（融入热点做法）
        recipeTemplate.steps[1] = modifyWithTrendMethod(recipeTemplate.steps[1]);
        
        // 添加热点标识数据
        recipeTemplate.trendData = {
            type: 'airfryer',
            platform: 'TikTok',
            views: '500万+',
            likes: '10万+',
            isHot: true
        };
    }
    
    // 3. 如果已关联膳食档案，添加个性化建议
    if (state.dietaryGuideline.isSet && state.dietaryGuideline.parsedProfile) {
        const profile = state.dietaryGuideline.parsedProfile;
        if (profile.healthGoals && profile.healthGoals.length > 0) {
            recipeTemplate.reason = `根据您的"${profile.healthGoals[0]}"目标推荐，${recipeTemplate.reason}`;
        }
    }
    
    return recipeTemplate;
}
```

#### 7.2.2 膳食档案报告生成

```javascript
function generateMockReport(userInput) {
    // 1. 根据关键词调整营养方案
    const inputLower = userInput.toLowerCase();
    let plan = {
        calories: '1800-2000',
        carbs: '50-55%',
        protein: '15-20%',
        fat: '25-30%',
        adviceTags: ['均衡营养', '适量运动']
    };
    
    // 2. 智能识别用户需求
    if (inputLower.includes('减肥') || inputLower.includes('减脂')) {
        plan = adjustPlanForWeightLoss(plan);
    } else if (inputLower.includes('增肌')) {
        plan = adjustPlanForMuscleGain(plan);
    } else if (inputLower.includes('控糖') || inputLower.includes('糖尿病')) {
        plan = adjustPlanForDiabetes(plan);
    }
    // ... 更多场景判断
    
    // 3. 生成Markdown格式报告
    const report = generateMarkdownReport(userInput, plan);
    
    return { report, plan };
}
```

#### 7.2.3 用户档案解析

```javascript
function parseUserProfile(text) {
    const profile = {
        age: null,
        gender: null,
        height: null,
        weight: null,
        bmi: null,
        bmiStatus: null,
        chronicDiseases: [],
        healthGoals: [],
        dietaryRestrictions: [],
        lifestyle: null
    };
    
    // 1. 正则提取年龄
    const ageMatch = text.match(/(\d{1,3})\s*岁/);
    if (ageMatch) profile.age = parseInt(ageMatch[1]);
    
    // 2. 提取性别
    if (text.includes('男')) profile.gender = '男';
    else if (text.includes('女')) profile.gender = '女';
    
    // 3. 提取身高体重
    const heightMatch = text.match(/身高\s*[:：]?\s*(\d{2,3})/);
    const weightMatch = text.match(/体重\s*[:：]?\s*(\d{2,3})/);
    if (heightMatch) profile.height = parseInt(heightMatch[1]);
    if (weightMatch) profile.weight = parseInt(weightMatch[1]);
    
    // 4. 计算BMI
    if (profile.height && profile.weight) {
        const heightInM = profile.height / 100;
        profile.bmi = (profile.weight / (heightInM * heightInM)).toFixed(1);
        profile.bmiStatus = getBMIStatus(parseFloat(profile.bmi));
    }
    
    // 5. 提取慢性病、健康目标、饮食禁忌
    profile.chronicDiseases = extractChronicDiseases(text);
    profile.healthGoals = extractHealthGoals(text);
    profile.dietaryRestrictions = extractDietaryRestrictions(text);
    
    return profile;
}
```

### 7.3 性能优化

#### 7.3.1 防抖与节流

```javascript
// 防抖：搜索输入
const debounce = (func, wait) => {
    let timeout;
    return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
    };
};

// 使用
headerSearchInput.addEventListener('input', debounce((e) => {
    state.discoverySearch = e.target.value;
    loadDiscoveryFeed();
}, 300));
```

#### 7.3.2 懒加载

```javascript
// 图片懒加载（可选）
const lazyLoadImages = () => {
    const images = document.querySelectorAll('img[data-src]');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                observer.unobserve(img);
            }
        });
    });
    images.forEach(img => observer.observe(img));
};
```

#### 7.3.3 DOM操作优化

```javascript
// 批量渲染，减少重排
const renderCookbook = () => {
    const fragment = document.createDocumentFragment();
    state.savedRecipes.forEach(recipe => {
        const card = createRecipeCard(recipe);
        fragment.appendChild(card);
    });
    cookbookGrid.innerHTML = '';
    cookbookGrid.appendChild(fragment);
};
```

### 7.4 兼容性处理

#### 7.4.1 浏览器兼容

- **现代浏览器**：Chrome 90+, Safari 14+, Firefox 88+, Edge 90+
- **移动端**：iOS Safari 14+, Chrome Mobile 90+
- **不支持**：IE 11及以下

#### 7.4.2 CSS兼容处理

```css
/* 使用前缀（如需兼容旧版浏览器） */
-webkit-backdrop-filter: blur(10px);
backdrop-filter: blur(10px);

/* 渐变回退 */
background: #52c41a;  /* 回退色 */
background: linear-gradient(135deg, #52c41a, #73d13d);
```

#### 7.4.3 JavaScript兼容处理

```javascript
// 可选链操作符（现代浏览器支持）
const value = state.dietaryGuideline?.parsedProfile?.age;

// 如需兼容旧浏览器，使用传统写法
const value = state.dietaryGuideline && 
              state.dietaryGuideline.parsedProfile && 
              state.dietaryGuideline.parsedProfile.age;
```

---

## 8. 数据流与状态管理

### 8.1 数据流向图

```
用户输入
    ↓
前端验证
    ↓
状态更新（state对象）
    ↓
UI重新渲染
    ↓
（可选）持久化到 localStorage
```

### 8.2 关键数据流

#### 8.2.1 生成食谱数据流

```
用户输入 + 热点开关状态 + 膳食档案
    ↓
generateMockRecipe()
    ↓
{
    title, tags, calories, time, serving, difficulty,
    image, ingredients, steps, nutrition,
    description, reason,
    trendData?, optimizationNote?
}
    ↓
state.lastRecipe = recipeData
    ↓
renderSpecificRecipe(recipeData)
    ↓
显示在结果卡片
```

#### 8.2.2 保存食谱数据流

```
state.lastRecipe
    ↓
state.savedRecipes.unshift(lastRecipe)
    ↓
localStorage.setItem('trendchef_saved_recipes', JSON.stringify(state.savedRecipes))
    ↓
renderCookbook()
    ↓
食谱书页面更新
```

#### 8.2.3 膳食档案数据流

```
用户输入（标签 + 描述）
    ↓
合并为完整文本
    ↓
generateMockReport(text)
    ↓
{
    report: "Markdown格式报告",
    plan: { calories, carbs, protein, fat, ... }
}
    ↓
parseUserProfile(text)
    ↓
{
    age, gender, height, weight, bmi, bmiStatus,
    chronicDiseases, healthGoals, dietaryRestrictions, lifestyle
}
    ↓
state.dietaryGuideline = {
    userInput: "...",
    selectedTags: [...],
    report: "...",
    parsedProfile: {...},
    dietPlan: {...},
    generatedAt: Date.now(),
    isSet: true
}
    ↓
localStorage.setItem('trendchef_dietary_guideline', JSON.stringify(state.dietaryGuideline))
    ↓
updateGuidelineUI()
    ↓
首页显示"已关联膳食档案"提示
```

### 8.3 状态同步机制

#### 8.3.1 初始化加载

```javascript
document.addEventListener('DOMContentLoaded', () => {
    // 1. 初始化状态
    initializeApp();
    
    // 2. 恢复本地存储数据
    hydrateGuidelineFromStorage();
    hydrateSavedRecipes();
    
    // 3. 绑定事件监听
    setupEventListeners();
    
    // 4. 渲染初始UI
    renderCookbook();
    updateGuidelineUI();
    
    // 5. 检查首次访问
    checkFirstVisit();
});
```

#### 8.3.2 状态更新触发UI

```javascript
// 每次状态更新后，调用对应的UI更新函数
const updateState = (key, value) => {
    state[key] = value;
    
    // 根据更新的状态，触发对应UI更新
    switch(key) {
        case 'currentTab':
            switchTab(value);
            break;
        case 'savedRecipes':
            renderCookbook();
            break;
        case 'dietaryGuideline':
            updateGuidelineUI();
            renderProfileGuideline();
            break;
    }
};
```

---

## 9. 未来扩展方向

### 9.1 后端集成

**需要的API端点：**
1. `POST /api/generate-recipe` - 真实AI生成食谱
2. `POST /api/generate-dietary-guideline` - 真实AI生成膳食档案
3. `GET /api/farm-products` - 获取农场产品列表
4. `POST /api/user/register` - 用户注册
5. `POST /api/user/login` - 用户登录
6. `POST /api/recipes/save` - 保存食谱到云端
7. `GET /api/recipes/my` - 获取用户的云端食谱

### 9.2 功能增强

1. **社交分享**
   - 生成食谱分享卡片（图片）
   - 分享到微信、微博、小红书

2. **智能购物车**
   - 根据食谱自动生成购物清单
   - 一键加入农场购物车

3. **食谱评分与评论**
   - 用户可以对食谱评分
   - 添加制作心得和改进建议

4. **个性化推荐**
   - 基于用户历史生成和收藏，推荐相似食谱
   - 基于膳食档案，每日推荐健康食谱

5. **营养追踪**
   - 记录每日饮食
   - 生成营养摄入报告
   - 与膳食指南对比

### 9.3 商业化功能

1. **会员体系**
   - 免费版：每日生成次数限制
   - 会员版：无限生成 + 专属功能

2. **农场订阅**
   - 每周蔬菜盲盒配送
   - 会员专享折扣

3. **营养师咨询**
   - 在线咨询专业营养师
   - 定制深度膳食方案

---

## 10. 附录

### 10.1 配色系统详细参数

| CSS变量 | 颜色值 | 用途 |
|---------|-------|------|
| --color-bg-primary | #000000 | 主背景色 |
| --color-bg-secondary | #0a0a0a | 次级背景 |
| --color-bg-card | #1a1a1a | 卡片背景 |
| --color-bg-card-hover | #222222 | 卡片悬停 |
| --color-accent-primary | #52c41a | 主强调色（健康绿） |
| --color-accent-secondary | #73d13d | 次强调色 |
| --color-accent-dark | #389e0d | 深色强调 |
| --color-text-primary | #ffffff | 主文字色 |
| --color-text-secondary | #b0b0b0 | 次级文字 |
| --color-text-muted | #707070 | 弱化文字 |
| --color-border | #2a2a2a | 边框色 |

### 10.2 字体系统

**字体栈：**
```css
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
```

**字号规范：**
| 用途 | 大小 | 行高 | 字重 |
|-----|------|------|------|
| H1大标题 | 2.2rem | 1.3 | 800 |
| H2标题 | 1.5rem | 1.4 | 700 |
| H3小标题 | 1.1rem | 1.4 | 600 |
| 正文 | 1rem | 1.6 | 400 |
| 小字 | 0.875rem | 1.5 | 400 |
| 提示文字 | 0.75rem | 1.4 | 500 |

### 10.3 间距系统

| CSS变量 | 数值 | 使用场景 |
|---------|------|---------|
| --spacing-xs | 0.5rem (8px) | 小间距、按钮内边距 |
| --spacing-sm | 1rem (16px) | 标准间距、卡片间距 |
| --spacing-md | 1.5rem (24px) | 中等间距、分区间距 |
| --spacing-lg | 2rem (32px) | 大间距、模块间距 |
| --spacing-xl | 3rem (48px) | 超大间距、页面留白 |

### 10.4 圆角系统

| CSS变量 | 数值 | 使用场景 |
|---------|------|---------|
| --radius-sm | 8px | 小元素、标签 |
| --radius-md | 12px | 输入框、按钮 |
| --radius-lg | 16px | 卡片 |
| --radius-xl | 24px | 弹窗、大卡片 |
| --radius-full | 9999px | 圆形按钮、药丸形标签 |

### 10.5 阴影系统

| CSS变量 | 数值 | 使用场景 |
|---------|------|---------|
| --shadow-sm | 0 2px 8px rgba(0,0,0,0.3) | 小卡片 |
| --shadow-md | 0 4px 16px rgba(0,0,0,0.4) | 普通卡片 |
| --shadow-lg | 0 8px 32px rgba(0,0,0,0.5) | 大卡片、弹窗 |
| --shadow-glow | 0 0 20px rgba(82,196,26,0.15) | 强调元素发光 |
| --shadow-glow-strong | 0 0 30px rgba(82,196,26,0.35) | 强强调发光 |

---

## 结语

本文档详细描述了 TrendChef 农庄智能平台的功能需求、用户交互流程、界面设计要求和技术实现方案。文档面向产品经理、UI/UX设计师、前端开发工程师和测试工程师，为项目的设计和开发提供全面的参考依据。

**文档版本：** V1.0  
**创建日期：** 2025-12-30  
**最后更新：** 2025-12-30  
**维护者：** TrendChef 产品团队

