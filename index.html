<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TrendChef - 紧跟全网热点的智能美食助手。结合AI与舆情大数据,推荐最流行的烹饪趋势,一键复刻网红爆款。">
    <meta name="keywords" content="AI美食,智能食谱,网红美食,舆情大数据,TrendChef">
    <title>TrendChef - 紧跟全网热点的智能美食助手</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Main Container -->
    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="header-title" id="headerTitle">AI农庄膳食平台</div>
            <div class="header-category-tabs hidden" id="headerCategoryTabs">
                <button class="header-category-tab active" data-category="all">当季蔬菜</button>
                <button class="header-category-tab" data-category="healthy">有机特供</button>
                <button class="header-category-tab" data-category="budget">农场活动</button>
            </div>
            <div class="header-search hidden" id="headerSearch">
                <svg class="search-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="headerSearchInput" placeholder="搜农产品">
            </div>
        </header>

        <!-- 个性化膳食档案生成弹窗 -->
        <!-- 个性化膳食档案生成弹窗 (Redesigned) -->
        <div class="health-modal" id="dietaryModal">
            <div class="health-modal-overlay"></div>
            <div class="health-modal-content large-modal">
                <!-- Header -->
                <div class="health-modal-header premium-header">
                    <div class="header-icon-container">
                        <span class="header-icon">🥗</span>
                    </div>
                    <div class="header-text">
                        <h3>AI 膳食健康顾问</h3>
                        <p class="header-subtitle">为您定制专属的营养引擎</p>
                    </div>
                    <button class="health-modal-close" id="dietaryModalClose">✕</button>
                </div>

                <!-- 步骤1：输入信息 -->
                <div class="dietary-step" id="dietaryInputStep">

                    <!-- 引导问题 -->
                    <div class="input-section">
                        <label class="input-label">如果您是为自己或家人定制，请描述：</label>

                        <!-- 快捷标签选择区 -->
                        <div class="quick-tags-container">
                            <!-- Category 1: Target -->
                            <div class="tag-category">
                                <span class="category-label">👥 对象</span>
                                <div class="tags-row" id="quickTagsTarget">
                                    <button class="quick-tag-chip" data-text="我是上班族，平时久坐">💼 上班族</button>
                                    <button class="quick-tag-chip" data-text="为家里老人准备">👴 老年人</button>
                                    <button class="quick-tag-chip" data-text="为正在长身体的孩子准备">🧒 儿童</button>
                                    <button class="quick-tag-chip" data-text="我是健身爱好者">🏋️ 健身党</button>
                                </div>
                            </div>

                            <!-- Category 2: Goals -->
                            <div class="tag-category">
                                <span class="category-label">🎯 目标</span>
                                <div class="tags-row" id="quickTagsGoals">
                                    <button class="quick-tag-chip" data-text="我想减脂塑形">🔥 减脂</button>
                                    <button class="quick-tag-chip" data-text="我想增肌增重">💪 增肌</button>
                                    <button class="quick-tag-chip" data-text="注意控糖">🍬 控糖</button>
                                    <button class="quick-tag-chip" data-text="调理肠胃">🥬 养胃</button>
                                </div>
                            </div>

                            <!-- Category 3: Conditions -->
                            <div class="tag-category">
                                <span class="category-label">⚠️ 状况</span>
                                <div class="tags-row" id="quickTagsConditions">
                                    <button class="quick-tag-chip" data-text="有高血压">🩺 高血压</button>
                                    <button class="quick-tag-chip" data-text="海鲜过敏">🦐 海鲜过敏</button>
                                    <button class="quick-tag-chip" data-text="乳糖不耐受">🥛 乳糖不耐</button>
                                    <button class="quick-tag-chip" data-text="不吃辣">🌶️ 不吃辣</button>
                                </div>
                            </div>
                        </div>

                        <textarea id="dietaryInput" class="dietary-textarea premium-input"
                            placeholder="如有其他特殊需求或详细身体数据（如身高体重），请在此补充..."></textarea>
                    </div>

                    <button class="health-save-btn premium-btn-large" id="generateGuidelineBtn">
                        <span class="btn-icon">✨</span> 生成膳食建议
                    </button>
                </div>

                <!-- Loading 状态 -->
                <div class="dietary-loading" id="dietaryLoading" style="display: none;">
                    <div class="loading-spinner-container">
                        <div class="loading-spinner premium-spinner"></div>
                        <div class="loading-pulse"></div>
                    </div>
                    <div class="loading-steps">
                        <p class="loading-step active" id="loadStep1">🔍 正在分析您的身体数据...</p>
                        <p class="loading-step" id="loadStep2">📚 正在研读《中国居民膳食指南》...</p>
                        <p class="loading-step" id="loadStep3">✨ 正在为您定制专属食谱方案...</p>
                    </div>
                </div>

                <!-- 步骤2：报告展示 -->
                <div class="dietary-step" id="dietaryReportStep" style="display: none;">

                    <!-- 结构化摘要 -->
                    <div class="report-header-summary" id="reportHeaderSummary">
                        <!-- JS Will Populate This: Age, BMI, Key Tags -->
                    </div>

                    <div class="report-content" id="dietaryReportContent">
                        <!-- Markdown render area -->
                    </div>

                    <!-- 手动编辑区域 (默认隐藏) -->
                    <textarea id="dietaryReportEditor" class="dietary-textarea" style="display: none;"></textarea>

                    <div class="report-actions">
                        <button class="action-btn-outline" id="reEditBtn">重新填写</button>
                        <button class="action-btn-outline" id="editReportContentBtn">编辑</button>
                        <button class="health-save-btn" id="saveGuidelineBtn">保存</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Main Content Area -->
        <main class="main-content">

            <!-- Home/Generator Section -->
            <section id="home" class="content-section active">
                <div class="section-inner">
                    <div class="home-hero">
                        <h1 class="hero-main-title">您的康养膳食顾问</h1>
                        <p class="hero-subtitle">让每一餐都成为修护身心的良方。</p>
                        <div class="health-profile-hint" id="guidelineHint">
                            <span>✅ 已关联膳食档案，推荐将自动优化</span>
                        </div>
                    </div>

                    <!-- Generator Card -->
                    <div class="generator-card">
                        <!-- Compact Tags -->
                        <div class="compact-tags-carousel" id="dietaryTags">
                            <button class="tag-btn trending">空气炸锅</button>
                            <button class="tag-btn trending">尹正焖菜</button>
                            <button class="tag-btn health">减脂塑形</button>
                            <button class="tag-btn health">三高调理</button>
                        </div>

                        <!-- Input Area -->
                        <div class="input-group">
                            <textarea id="ingredientInput" class="ingredient-input" placeholder="输入食材或你想吃的菜，AI 为你定制..."
                                rows="3"></textarea>
                        </div>

                        <!-- Options & Actions -->
                        <div class="home-controls">
                            <!-- Dietary Guideline Guidance Module -->
                            <div class="health-guide-module" id="guidelinePrompt">
                                <div class="guide-content">
                                    <div class="guide-icon">🥗</div>
                                    <div class="guide-text">
                                        <h4>完善膳食档案</h4>
                                        <p>让 AI 建议更贴合您的健康需求</p>
                                    </div>
                                </div>
                                <button class="guide-action-btn" id="promptGenerateBtn">去设置</button>
                            </div>

                            <div class="action-buttons-group">
                                <!-- 融合热点开关 -->
                                <button class="trend-fusion-toggle" id="trendFusionToggle" 
                                    title="开启后将融入当前热门烹饪方法（如空气炸锅），让菜谱更时尚、更省时">
                                    <span class="toggle-icon">🔥</span>
                                    <span class="toggle-text">融合热点</span>
                                </button>
                                <button class="generate-btn-main" id="generateBtn" style="flex: 2;">生成菜谱</button>
                            </div>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div class="loading-state" id="loadingState">
                        <div class="loading-animation">
                            <div class="book-flip">
                                <div class="book-page"></div>
                                <div class="book-page"></div>
                                <div class="book-page"></div>
                            </div>
                        </div>
                        <p class="loading-text">AI 正在为你生成食谱...</p>
                    </div>

                    <!-- Recipe Result -->
                    <div class="recipe-result" id="recipeResult">
                        <div class="result-card">
                            <div class="result-image">
                                <img id="resultImage" src="" alt="Recipe">
                            </div>
                            <div class="result-content">
                                <h3 class="result-title" id="resultTitle"></h3>
                                
                                <!-- 融合模式标识 - 顶部展示（信息架构优化） -->
                                <div class="result-trend-badge" id="resultTrendBadge" style="display: none;"></div>
                                
                                <p class="result-description" id="resultDescription"></p>

                                <div class="result-meta">
                                    <span class="meta-item">⏱️ <span id="resultTime"></span></span>
                                    <span class="meta-item">👥 <span id="resultServing"></span></span>
                                    <span class="meta-item">🔥 <span id="resultDifficulty"></span></span>
                                </div>

                                <div class="result-steps" id="resultSteps"></div>

                                <!-- AI膳食优化建议 - 步骤后展示（信息架构优化） -->
                                <div class="result-ai-optimization" id="resultAIOptimization" style="display: none;"></div>

                                <div class="result-actions">
                                    <button class="action-btn primary" id="saveRecipeBtn">💾 保存到食谱书</button>
                                    <button class="action-btn secondary" id="shareRecipeBtn">🔗 分享</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Discover Section - 农场发现 -->
            <section id="discover" class="content-section">
                <div class="section-inner" id="discoveryFeedContainer">
                    <!-- Discovery Feed -->
                    <div class="discovery-feed" id="discoveryFeed">
                        <!-- Cards will be dynamically inserted here -->
                    </div>
                </div>

                <!-- 农产品/活动详情页 (新增) -->
                <div class="discovery-detail-page" id="discoveryDetail" style="display: none;">
                    <button class="back-btn-float" id="discoveryBackBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    </button>
                    
                    <div class="detail-hero-image">
                        <img id="detailImage" src="" alt="Detail">
                    </div>

                    <div class="detail-content-wrapper">
                        <div class="detail-header">
                            <h2 id="detailTitle" class="detail-title"></h2>
                            <div class="detail-price-row">
                                <span class="detail-price" id="detailPrice"></span>
                                <span class="detail-unit" id="detailUnit"></span>
                            </div>
                            <div class="detail-tags" id="detailTags"></div>
                        </div>

                        <div class="detail-seller-card">
                            <div class="seller-avatar" id="sellerAvatar">👤</div>
                            <div class="seller-info">
                                <div class="seller-name" id="sellerName"></div>
                                <div class="seller-badge" id="sellerType"></div>
                            </div>
                            <button class="contact-btn-sm" id="contactSellerBtnSmall">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                            </button>
                        </div>

                        <div class="detail-section">
                            <h3 class="section-title-sm">详细介绍</h3>
                            <p id="detailDesc" class="detail-text"></p>
                        </div>

                        <div class="detail-section">
                            <h3 class="section-title-sm">产地/地址</h3>
                            <div class="location-card" id="detailLocationCard">
                                <span class="location-icon">📍</span>
                                <span class="location-text" id="detailLocation"></span>
                            </div>
                        </div>

                        <!-- 底部留白，防遮挡 -->
                        <div style="height: 80px;"></div>
                    </div>

                    <!-- 底部操作栏 -->
                    <div class="detail-bottom-bar">
                        <button class="action-btn secondary" id="navToFarmBtn">
                            <span>📍 导航去农场</span>
                        </button>
                        <button class="action-btn primary" id="contactSellerBtnMain">
                            <span>💬 联系卖家</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Cookbook Section -->
            <section id="cookbook" class="content-section">
                <div class="section-inner">
                    <div class="cookbook-grid" id="cookbookGrid">
                        <!-- Empty state -->
                        <div class="empty-state">
                            <div class="empty-icon">📖</div>
                            <h3>还没有保存的食谱</h3>
                            <p>快去生成或收藏你喜欢的食谱吧!</p>
                            <button class="empty-action-btn" onclick="switchTab('home')">开始生成</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="content-section">
                <div class="section-inner">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <div class="avatar-circle">👤</div>
                        </div>
                        <div class="profile-info">
                            <h2 class="profile-name">美食探索者</h2>
                            <p class="profile-subtitle">TrendChef 会员</p>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value">12</div>
                                <div class="stat-label">生成</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">8</div>
                                <div class="stat-label">收藏</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">5</div>
                                <div class="stat-label">分享</div>
                            </div>
                        </div>
                    </div>

                    <!-- Dietary Guideline in Profile (moved forward) -->
                    <div class="profile-card guideline-profile-card" id="profileGuidelineCard" style="display: none;">
                        <div class="guideline-card-header">
                            <div class="guideline-card-title">📋 我的膳食档案</div>
                            <span class="guideline-date" id="guidelineDate"></span>
                        </div>
                        <div class="guideline-preview" id="guidelinePreview"></div>
                        <div class="guideline-actions">
                            <button class="action-btn primary" onclick="openGuidelineModal()">查看详情</button>
                            <button class="action-btn secondary-dim" id="resetDemoBtn"
                                style="margin-left: 8px; font-size: 0.75rem; opacity: 0.6;">🧪 重置演示状态</button>
                        </div>
                    </div>

                </div>
            </section>

        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-tab="home">
                <svg class="nav-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="nav-label">首页</span>
            </button>
            <button class="nav-item" data-tab="discover">
                <svg class="nav-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="2" y1="12" x2="22" y2="12"></line>
                    <path
                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                    </path>
                </svg>
                <span class="nav-label">发现</span>
            </button>
            <button class="nav-item" data-tab="cookbook">
                <svg class="nav-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
                <span class="nav-label">食谱</span>
            </button>
            <button class="nav-item" data-tab="profile">
                <svg class="nav-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span class="nav-label">我的</span>
            </button>
        </nav>

    </div>

    <!-- 首次访问欢迎弹窗 -->
    <div class="welcome-modal" id="welcomeModal" style="display: none;">
        <div class="welcome-modal-overlay"></div>
        <div class="welcome-content">
            <div class="welcome-icon">👋</div>
            <h2>欢迎来到 AI农庄膳食平台</h2>
            <p>我是您的专属AI营养师。基于《中国居民膳食指南》，为您定制个性化饮食方案。</p>
            <div class="welcome-actions">
                <button class="welcome-primary-btn" id="welcomeGenerateBtn">生成膳食档案</button>
                <button class="welcome-secondary-btn" id="welcomeSkipBtn">先看看</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>